<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QuickOrder ‚Äì 4‚ÄëModality Usability Test Prototype</title>
  <style>
    :root{
      --bg:#0c0f12;--card:#141820;--ink:#e5e7eb;--muted:#94a3b8;--brand:#f4b400;--ok:#22c55e;--danger:#ef4444;--border:#1f2937;--header-bg:#103233;--header-ink:#ffffff;--accent:#ff3b30;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans"}
    .container{max-width:min(420px, 96vw);margin:0 auto;padding:0 14px 96px}

    /* Header (dark green like mockup) */
    header{position:sticky;top:0;z-index:30;display:flex;align-items:center;justify-content:space-between;padding:12px 14px;margin:0 -14px 14px;background:var(--header-bg);color:var(--header-ink);border-bottom:1px solid rgba(255,255,255,.08)}
    .title{font-weight:800;font-size:20px}

    /* Cards + layout */
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.25)}
    .controls{display:flex;gap:8px;align-items:center}
    button,.seg button{appearance:none;border:1px solid var(--border);background:#0f131a;color:var(--ink);padding:10px 14px;border-radius:12px;cursor:pointer}
    button.primary{background:var(--brand);color:#111;border-color:var(--brand);font-weight:700}
    button.ghost{background:transparent}
    .seg{display:grid;grid-auto-flow:column;gap:0;background:#0f131a;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .seg button{border:0;border-right:1px solid var(--border)}
    .seg button:last-child{border-right:0}
    .seg button.active{background:#1b2430}

    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
    .pad{padding:14px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;align-items:center}
    input[type="number"], input[type="text"], textarea, select{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);outline:none;background:#0f131a;color:var(--ink)
    }
    textarea{min-height:160px;resize:vertical}
    .list{display:grid;gap:10px}
    .item{display:grid;grid-template-columns:1fr clamp(84px, 32vw, 120px);gap:10px;align-items:center}
    .item label{font-weight:600}
    .tag{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid var(--border);background:#0f131a;color:var(--ink)}
    .stack{display:grid;gap:12px}
    .footer{position:sticky;bottom:64px;z-index:10;background:linear-gradient(180deg, rgba(12,15,18,.2), rgba(12,15,18,.8));backdrop-filter:saturate(160%) blur(6px);padding:12px;border:1px solid var(--border);border-radius:14px}

    /* Confirmation modal */
    dialog{border:1px solid var(--border);background:var(--card);color:var(--ink);border-radius:16px;max-width:min(760px,96vw);padding:0}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .modal-head{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid var(--border)}
    .modal-body{padding:16px;display:grid;gap:12px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid var(--border);text-align:left;padding:8px 6px}
    .right{text-align:right}
    .pill{padding:2px 8px;border-radius:999px;background:#0f131a;border:1px solid var(--border);font-size:12px}

    /* Upload preview */
    .preview{display:grid;place-items:center;min-height:160px;border:1px dashed var(--border);border-radius:12px;overflow:hidden;background:#0f131a}
    .preview img{max-width:100%;height:auto;display:block}

    .help{font-size:12px;color:var(--muted)}

    /* Bottom Tab Bar (exact mockup style) */
    .tabbar{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-top:1px solid var(--border);padding:8px 18px;display:flex;justify-content:space-around;align-items:center;gap:12px}
    .tab-btn{appearance:none;background:transparent;border:0;cursor:pointer}
    .tab-icon{width:34px;height:34px;border-radius:999px;border:1px solid var(--border);display:grid;place-items:center;background:#0f131a}
    .tab-btn.active .tab-icon{outline:2px solid rgba(255,255,255,.08)}
    .dot{width:6px;height:6px;border-radius:999px;background:var(--accent);margin:6px auto 0}

    /* Home tiles */
    .home-tile{display:grid;gap:6px;text-align:left}
    .tile-img{height:96px;border-radius:12px;background:#0f131a;border:1px solid var(--border);display:grid;place-items:center;font-size:28px}
    .tile-title{font-weight:700}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="row" style="gap:10px">
        <div style="width:36px;height:36px;border-radius:999px;background:#0b3b34;display:grid;place-items:center;border:1px solid rgba(255,255,255,.2)">üë§</div>
        <div class="title" style="color:var(--header-ink)">QuickOrder</div>
      </div>
      <div class="controls">
        <span class="tag" style="background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2);color:#fff">Test timer: <span id="timer">00:00</span></span>
        <button id="startTestBtn" class="ghost" style="color:#fff;border-color:rgba(255,255,255,.2)">Start test</button>
        <button id="resetBtn" class="ghost" style="color:#fff;border-color:rgba(255,255,255,.2)">Reset</button>
        <button id="reviewBtn" class="primary">Review Order</button>
      </div>
    </header>

    <div class="card pad" style="margin-bottom:12px">
      <div class="row" style="justify-content:space-between;flex-wrap:wrap;gap:10px">
        <div class="row" style="gap:8px">
          <strong>Choose ONE modality:</strong>
          <div class="seg" id="modSeg">
            <button data-mod="cart" class="active">Catalogue</button>
            <button data-mod="text">Text</button>
            <button data-mod="photo">Photo</button>
            <button data-mod="sheet">Editable sheet</button>
          </div>
        </div>
        <div class="help">Goal: build a 15‚Äëitem replenishment order (you can pick any items).</div>
      </div>

      <!-- Home tiles (match your mockup cards) -->
      <div class="grid" id="homeGrid" style="margin-top:12px">
        <button class="card pad home-tile" data-go="cart">
          <div class="tile-img">üçá</div>
          <div class="tile-title">Browse & Select Items</div>
          <div class="muted">Catalogue with quantities</div>
        </button>
        <button class="card pad home-tile" data-go="text">
          <div class="tile-img">ü•¶</div>
          <div class="tile-title">Text me what you want</div>
          <div class="muted">Type lines like ‚ÄúRice x2‚Äù</div>
        </button>
        <button class="card pad home-tile" data-go="photo">
          <div class="tile-img">üç©</div>
          <div class="tile-title">Upload your picture</div>
          <div class="muted">Simulated OCR</div>
        </button>
        <button class="card pad home-tile" data-go="sheet">
          <div class="tile-img">ü•ù</div>
          <div class="tile-title">Edit your order sheet</div>
          <div class="muted">Inline editable table</div>
        </button>
      </div>
    </div>
        </div>
        <div class="help">Goal: build a 15‚Äëitem replenishment order (you can pick any items).</div>
      </div>
    </div>

    <section id="cart" class="card pad mod">
      <h3>Catalogue flow</h3>
      <p class="muted">Set quantities and they‚Äôll go straight into the shared order. All inputs are live.</p>
      <div class="grid" id="catalogue"></div>
    </section>

    <section id="text" class="card pad mod" hidden>
      <h3>Message‚Äëbased text entry</h3>
      <p class="muted">Enter lines like: <code>Salmon 3</code>, <code>Rice 10kg x2</code>, or <code>SKU1004 x 5</code>.</p>
      <div class="stack">
        <textarea id="textInput" placeholder="One item per line‚Ä¶"></textarea>
        <div class="row" style="justify-content:space-between">
          <span class="help">Tip: I‚Äôll try to match names or SKUs.</span>
          <button id="parseText">Add to order</button>
        </div>
      </div>
    </section>

    <section id="photo" class="card pad mod" hidden>
      <h3>Supplier order‚Äësheet photo</h3>
      <p class="muted">Upload or use camera. For this prototype, you can transcribe/adjust recognized lines before adding.</p>
      <div class="grid">
        <div class="stack">
          <label class="help">Upload image (simulated OCR)</label>
          <input id="imgInput" type="file" accept="image/*" capture="environment" />
          <div class="preview" id="imgPreview"><span class="muted">No image</span></div>
        </div>
        <div class="stack">
          <label class="help">Recognized lines (editable)</label>
          <textarea id="ocrText" placeholder="e.g. Salmon x 3\nRice 10kg x 2"></textarea>
          <div class="row" style="justify-content:end"><button id="addOcr">Add to order</button></div>
        </div>
      </div>
    </section>

    <section id="sheet" class="card pad mod" hidden>
      <h3>Editable online order sheet</h3>
      <p class="muted">Edit quantities directly. Click ‚ÄúSync to order‚Äù when ready.</p>
      <div class="stack">
        <div style="overflow:auto">
          <table class="table" id="sheetTable" aria-label="Editable order sheet">
            <thead>
              <tr><th>SKU</th><th>Item</th><th>Pack</th><th class="right">Qty</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="row" style="justify-content:end;gap:10px">
          <span class="help">Only positive quantities will be synced.</span>
          <button id="syncSheet" class="primary">Sync to order</button>
        </div>
      </div>
    </section>

    <div class="footer row" style="justify-content:space-between;flex-wrap:wrap">
      <div class="row" style="gap:8px"><span class="pill">Items: <strong id="orderCount">0</strong></span><span class="pill">SKUs: <strong id="skuCount">0</strong></span></div>
      <div class="row" style="gap:8px"><button id="clearBtn">Clear</button><button id="reviewBtnFooter" class="primary">Submit order</button></div>
    </div>

    <!-- Bottom Tab Bar (3 icons, center with red dot like mockup) -->
    <nav class="tabbar">
      <button class="tab-btn" id="tabHome" aria-label="Home">
        <div class="tab-icon">üíª</div>
        <div class="dot" style="opacity:.0"></div>
      </button>
      <button class="tab-btn active" id="tabBuild" aria-label="Build">
        <div class="tab-icon">üéØ</div>
        <div class="dot"></div>
      </button>
      <button class="tab-btn" id="tabCart" aria-label="Cart">
        <div class="tab-icon">üõí</div>
        <div class="dot" style="opacity:.0"></div>
      </button>
    </nav>
  </div>
  </div>

  <dialog id="confirmDlg">
    <div class="modal-head">
      <strong>Review order</strong>
      <button id="closeDlg">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="stack">
        <table class="table" id="confirmTable">
          <thead><tr><th>SKU</th><th>Item</th><th class="right">Qty</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><th colspan="2" class="right">Total items</th><th id="totalQty" class="right">0</th></tr></tfoot>
        </table>
        <div class="grid">
          <input id="custName" placeholder="Restaurant / Customer name" />
          <input id="poNumber" placeholder="PO number (optional)" />
        </div>
        <div class="row" style="justify-content:space-between">
          <span id="confirmHint" class="help">Confirm to simulate export.</span>
          <div class="row" style="gap:8px">
            <button id="backToEdit">Back</button>
            <button id="confirmBtn" class="primary">Confirm order</button>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <script>
  // ---------- Sample catalogue data ----------
  const CATALOGUE = [
    { sku:"SKU1001", name:"Salmon fillet", pack:"1kg" },
    { sku:"SKU1002", name:"Rice", pack:"10kg bag" },
    { sku:"SKU1003", name:"Soy sauce", pack:"1L bottle" },
    { sku:"SKU1004", name:"Seaweed sheets", pack:"50 pcs" },
    { sku:"SKU1005", name:"Tofu", pack:"12 x 300g" },
    { sku:"SKU1006", name:"Ramen noodles", pack:"20 x 200g" },
    { sku:"SKU1007", name:"Chicken thighs", pack:"2kg" },
    { sku:"SKU1008", name:"Pork belly", pack:"2kg" },
    { sku:"SKU1009", name:"Shrimp", pack:"1kg" },
    { sku:"SKU1010", name:"Wasabi paste", pack:"12 x 43g" },
  ];

  // ---------- State ----------
  const order = new Map(); // key sku -> { sku, name, qty }
  const byNameIndex = new Map(CATALOGUE.map(i=>[i.name.toLowerCase(), i]));
  const bySkuIndex = new Map(CATALOGUE.map(i=>[i.sku.toLowerCase(), i]));

  const $ = sel => document.querySelector(sel);
  const $$ = sel => [...document.querySelectorAll(sel)];

  const setOrderQty = (item, qty) => {
    qty = Math.max(0, Math.floor(qty||0));
    if(qty>0){ order.set(item.sku, { sku:item.sku, name:item.name, qty }); }
    else { order.delete(item.sku); }
    renderFooter();
  };

  const renderFooter = () => {
    const total = [...order.values()].reduce((a,b)=>a+b.qty,0);
    $('#orderCount').textContent = total;
    $('#skuCount').textContent = order.size;
  };

  // ---------- Catalogue UI ----------
  const catHost = $('#catalogue');
  function renderCatalogue(){
    catHost.innerHTML = '';
    CATALOGUE.forEach(item => {
      const wrap = document.createElement('div');
      wrap.className = 'card pad';
      wrap.innerHTML = `
        <div class="item">
          <div>
            <div><strong>${item.name}</strong></div>
            <div class="muted">${item.sku} ‚Ä¢ ${item.pack}</div>
          </div>
          <div class="row">
            <input type="number" inputmode="numeric" min="0" step="1" placeholder="0" data-sku="${item.sku}" aria-label="${item.name} quantity" />
          </div>
        </div>`;
      catHost.appendChild(wrap);
    });

    // attach events
    $$('#catalogue input[type=number]').forEach(inp=>{
      const sku = inp.dataset.sku;
      const item = bySkuIndex.get(sku.toLowerCase());
      inp.addEventListener('input', e=>{
        setOrderQty(item, parseInt(inp.value||'0',10));
      });
    });
  }

  // ---------- Text parsing ----------
  function parseLines(raw){
    const lines = raw.split(/\n+/).map(l=>l.trim()).filter(Boolean);
    const out = [];
    for(const line of lines){
      // try SKU first
      const mSku = line.match(/(sku\d{4})\D*(\d+)/i);
      if(mSku){
        const sku = mSku[1];
        const qty = parseInt(mSku[2],10);
        const item = bySkuIndex.get(sku.toLowerCase());
        if(item && qty>0) out.push({item, qty});
        continue;
      }
      // name + qty like "Rice 10kg x2" or "Salmon 3"
      const mName = line.match(/(.+?)\s*(?:x|√ó)?\s*(\d+)$/i);
      if(mName){
        const name = mName[1].trim().toLowerCase();
        const qty = parseInt(mName[2],10);
        const item = byNameIndex.get(name);
        if(item && qty>0) out.push({item, qty});
      }
    }
    return out;
  }

  $('#parseText').addEventListener('click', ()=>{
    const pairs = parseLines($('#textInput').value);
    if(pairs.length===0){ alert('No recognizable items. Try format: "SKU1004 x 5" or "Rice 10kg x2"'); return; }
    pairs.forEach(({item, qty})=> setOrderQty(item, (order.get(item.sku)?.qty||0)+qty));
    alert('Added ' + pairs.length + ' line(s) to order.');
  });

  // ---------- Photo (simulated OCR) ----------
  $('#imgInput').addEventListener('change', (e)=>{
    const file = e.target.files?.[0];
    const prev = $('#imgPreview');
    prev.innerHTML='';
    if(file){
      const img = new Image();
      img.onload = ()=> prev.appendChild(img);
      img.src = URL.createObjectURL(file);
    }else{
      prev.innerHTML = '<span class="muted">No image</span>';
    }
  });

  $('#addOcr').addEventListener('click', ()=>{
    const pairs = parseLines($('#ocrText').value);
    if(pairs.length===0){ alert('No recognizable lines in OCR area.'); return; }
    pairs.forEach(({item, qty})=> setOrderQty(item, (order.get(item.sku)?.qty||0)+qty));
    alert('Added ' + pairs.length + ' line(s) to order.');
  });

  // ---------- Editable sheet ----------
  const sheetBody = $('#sheetTable tbody');
  function renderSheet(){
    sheetBody.innerHTML='';
    CATALOGUE.forEach(it=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${it.sku}</td>
        <td>${it.name}</td>
        <td>${it.pack}</td>
        <td class="right"><input type="number" min="0" step="1" placeholder="0" style="max-width:90px" data-sku="${it.sku}"></td>
      `;
      sheetBody.appendChild(tr);
    });
  }

  $('#syncSheet').addEventListener('click', ()=>{
    const inputs = $$('#sheetTable input[type=number]');
    let changed = 0;
    inputs.forEach(inp=>{
      const qty = parseInt(inp.value||'0',10);
      if(qty>0){
        const item = bySkuIndex.get(inp.dataset.sku.toLowerCase());
        setOrderQty(item, qty);
        changed++;
      }
    });
    alert('Synced '+changed+' line(s) to order.');
  });

  // ---------- Router + navigation (hash-based) ----------
  function showScreen(id){
    document.querySelectorAll('.mod').forEach(sec=>{ sec.hidden = (sec.id !== id); });
    document.querySelectorAll('#modSeg button').forEach(btn=> btn.classList.toggle('active', btn.dataset.mod===id));
    document.querySelectorAll('.tab-btn').forEach(b=> b.classList.remove('active'));
    if(id==='cart'||id==='text'||id==='photo'||id==='sheet') document.getElementById('tabBuild').classList.add('active');
  }
  function renderRoute(){
    const id = (location.hash || '#cart').replace('#','');
    if(id === 'confirm'){ openConfirm(); return; }
    const valid = ['cart','text','photo','sheet'];
    showScreen(valid.includes(id) ? id : 'cart');
  }
  window.addEventListener('hashchange', renderRoute);

  // segmented buttons route to pages
  const seg = document.getElementById('modSeg');
  seg.addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-mod]');
    if(!btn) return;
    location.hash = btn.dataset.mod; // triggers renderRoute via hashchange
  });

  // Home tiles switching
  document.getElementById('homeGrid')?.addEventListener('click', (e)=>{
    const tile = e.target.closest('[data-go]');
    if(!tile) return; location.hash = tile.dataset.go;
  });

  // Bottom tabs
  document.getElementById('tabHome').addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));
  document.getElementById('tabBuild').addEventListener('click', ()=> location.hash='cart');
  document.getElementById('tabCart').addEventListener('click', ()=> openConfirm());

  // initial route
  renderRoute();

// ---------- Review & Confirm ----------
  const dlg = $('#confirmDlg');
  function openConfirm(){
    const tb = $('#confirmTable tbody');
    tb.innerHTML='';
    let total=0;
    for(const row of order.values()){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${row.sku}</td><td>${row.name}</td><td class="right">${row.qty}</td>`;
      tb.appendChild(tr);
      total += row.qty;
    }
    $('#totalQty').textContent = total;
    if(order.size===0){ $('#confirmHint').textContent='No items. Add something first.'; }
    else { $('#confirmHint').textContent='Confirm to simulate export.'; }
    dlg.showModal();
  }
  $('#reviewBtn').addEventListener('click', openConfirm);
  $('#reviewBtnFooter').addEventListener('click', openConfirm);
  $('#closeDlg').addEventListener('click', ()=> dlg.close());
  $('#backToEdit').addEventListener('click', ()=> dlg.close());

  $('#confirmBtn').addEventListener('click', ()=>{
    if(order.size===0){ alert('Order is empty.'); return; }
    const cust = $('#custName').value.trim();
    if(!cust){ alert('Please enter a customer name.'); return; }
    const id = 'QO-' + Math.random().toString(36).slice(2,8).toUpperCase();
    alert('Order confirmed!\nOrder ID: '+id+'\nSKUs: '+order.size+'\nTotal items: '+[...order.values()].reduce((a,b)=>a+b.qty,0));
    order.clear();
    renderFooter();
    $$('#catalogue input[type=number]').forEach(i=>i.value='');
    $$('#sheetTable input[type=number]').forEach(i=>i.value='');
    $('#textInput').value='';
    $('#ocrText').value='';
    dlg.close();
  });

  // ---------- Timer for test sessions ----------
  let t0=null, ticker=null;
  function fmt(sec){
    const m = String(Math.floor(sec/60)).padStart(2,'0');
    const s = String(Math.floor(sec%60)).padStart(2,'0');
    return m+':'+s;
  }
  function startTimer(){
    t0 = Date.now();
    if(ticker) clearInterval(ticker);
    ticker = setInterval(()=>{
      const sec = (Date.now()-t0)/1000;
      $('#timer').textContent = fmt(sec);
    }, 250);
  }
  function resetAll(){
    if(ticker) clearInterval(ticker);
    ticker=null; t0=null; $('#timer').textContent='00:00';
    order.clear(); renderFooter();
    $$('#catalogue input[type=number]').forEach(i=>i.value='');
    $$('#sheetTable input[type=number]').forEach(i=>i.value='');
    $('#textInput').value=''; $('#ocrText').value='';
  }
  $('#startTestBtn').addEventListener('click', startTimer);
  $('#resetBtn').addEventListener('click', resetAll);
  $('#clearBtn').addEventListener('click', ()=>{ order.clear(); renderFooter(); alert('Order cleared.'); });

  // ---------- Init ----------
  renderCatalogue();
  renderSheet();
  renderFooter();
  </script>
</body>
</html>
